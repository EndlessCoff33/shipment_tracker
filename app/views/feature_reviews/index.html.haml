%h1 Feature Review

.row
  .col-lg-6
    - panel(heading: 'Summary', status: @presenter.summary_status, klass: 'summary') do
      %ul.list-group
        %li.list-group-item
          %strong
            - icon summary_item_classes(@presenter.build_status)
            %span.title Test Results
        %li.list-group-item
          %strong
            - icon summary_item_classes(@presenter.deploy_status)
            %span.title UAT Environment
        %li.list-group-item
          %strong
            - icon summary_item_classes(@presenter.qa_status)
            %span.title QA Acceptance

  .col-lg-6
    - panel(heading: 'Apps Under Review', klass: 'app-info') do
      %ul.list-group
        - @apps.each do |name, version|
          %li.list-group-item.app
            %strong.name= name
            %span.version= short_sha(version)
        %li.list-group-item
          - if @uat_url.present?
            Deployed to UAT
            %strong.uat-url= to_link(@uat_url, target: '_blank')
          - else
            No UAT specified

.row
  .col-lg-12
    - panel(heading: 'Associated Tickets', klass: 'tickets') do
      - if @presenter.tickets.empty?
        .panel-body No tickets found
      - else
        - table(headers: %w(Key Summary Status)) do
          - @presenter.tickets.each do |ticket|
            %tr.ticket
              %td= ticket.key
              %td= ticket.summary
              %td= ticket.status

.row
  .col-lg-6
    - panel(heading: 'UAT Environment', klass: 'deploys', status: @presenter.deploy_status) do
      - if @presenter.deploys.empty?
        .panel-body No deploys found
      - else
        - table(headers: %w(Correct App Version)) do
          - @presenter.deploys.each do |deploy|
            %tr.deploy
              %td
                - icon deploy_status_icon_class(deploy.correct)
              %td= deploy.app_name
              %td= short_sha(deploy.version)

  .col-lg-6
    - panel(heading: 'Test Results', klass: 'builds', status: @presenter.build_status) do
      - if @presenter.builds.empty?
        .panel-body No builds found
      - else
        - table(headers: %w(Status App Source)) do
          - @presenter.builds.each do |app_name, build|
            %tr.build
              %td
                - icon build_status_icon_class(build.status)
              %td= app_name
              %td= build.source

.row
  .col-lg-6
    - panel(heading: 'QA Acceptance', klass: 'qa-submission', status: @presenter.qa_status) do
      .panel-body
        - if @presenter.qa_submission
          %span.qa-name
            %strong= @presenter.qa_submission.name
          at
          %span.qa-time= @presenter.qa_submission.created_at
        - else
          Not reviewed by QA
      .panel-footer
        = form_tag(events_path(type: 'manual_test'), method: 'post', class: 'form-inline') do
          = hidden_field_tag(:return_to, @return_to)
          = hidden_field_tag('testing_environment[uat_url]', @uat_url)
          - @apps.each do |app_name, version|
            = hidden_field_tag('testing_environment[apps][][name]', app_name)
            = hidden_field_tag('testing_environment[apps][][version]', version)
          .radio.qa-accept
            %label
              = radio_button_tag 'status', 'success', required: true
              Accept
          .radio.qa-reject
            %label
              = radio_button_tag 'status', 'failed', required: true
              Reject
          = label_tag('user[name]', 'Name', class: 'control-label sr-only')
          = text_field_tag('user[name]', '', placeholder: 'Firstname Surname', class: 'form-control qa-name-field', required: true)
          = submit_tag('Submit', class: 'btn btn-primary')

