%h1 Feature for review

%h3 Associated tickets
%table.table.table-striped
  %thead
    %tr
      %th Key
      %th Summary
      %th Description
      %th Status
  %tbody
    - @projection.tickets.each do |ticket|
      %tr.ticket
        %td= ticket.key
        %td= ticket.summary
        %td= ticket.description
        %td= ticket.status

%table.table.table-striped
  %thead
    %tr
      %th Application
      %th Version
  %tbody
    - @apps.each do |name, version|
      %tr.app-info
        %td= name
        %td= version

- @projection.builds.each do |app_name, builds|
  %div{class: app_name}
    %h3= "Builds for #{app_name}"
    %table.table.table-striped
      %thead
        %tr
          %th Source
          %th Status
      %tbody
        - builds.each do |build|
          %tr.build
            %td= build.source
            %td= build.status

%h3
  Deploys to
  %span.uat-url= @uat_url
%table.table.table-striped
  %thead
    %tr
      %th App
      %th Version
      %th Correct
  %tbody
    - @projection.deploys.each do |deploy|
      %tr.deploy
        %td= deploy.app_name
        %td= deploy.version
        %td= deploy.correct == :ignore ? '' : deploy.correct

%h3 QA acceptance

%table.table.table-striped
  %thead
    %tr
      %th Name
      %th Status
      %th Time
  %tbody
    %tr.qa-submission
      %td= @projection.qa_submission.try(:name)
      %td= @projection.qa_submission.try(:status)
      %td= @projection.qa_submission.try(:created_at)

= form_tag(events_path(type: 'manual_test'), method: 'post', class: 'form-horizontal') do
  = hidden_field_tag(:return_to, @return_to)
  = hidden_field_tag('testing_environment[uat_url]', @uat_url)
  - @apps.each do |app_name, version|
    = hidden_field_tag('testing_environment[apps][][name]', app_name)
    = hidden_field_tag('testing_environment[apps][][version]', version)
  .row
    .radio.col-md-1
      %label
        = radio_button_tag 'status', 'success'
        Accept
    .radio.col-md-1
      %label
        = radio_button_tag 'status', 'failed'
        Reject
    = label_tag('user[name]', 'Name', class: 'col-md-1 control-label')
    .col-md-6
      = text_field_tag('user[name]', '', placeholder: 'Firstname Surname', class: 'form-control')
    .col-md-2
      = submit_tag('Submit', class: 'btn btn-primary')

